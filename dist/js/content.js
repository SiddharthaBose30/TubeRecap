(()=>{"use strict";const e=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,t="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36,gzip(gfe)",n=/<text start="([^"]*)" dur="([^"]*)">([^<]*)<\/text>/g;class a extends Error{constructor(e){super(`[YoutubeTranscript] ðŸš¨ ${e}`)}}class r extends a{constructor(){super("YouTube is receiving too many requests from this IP and now requires solving a captcha to continue")}}class o extends a{constructor(e){super(`The video is no longer available (${e})`)}}class i extends a{constructor(e){super(`Transcript is disabled on this video (${e})`)}}class s extends a{constructor(e){super(`No transcripts are available for this video (${e})`)}}class c extends a{constructor(e,t,n){super(`No transcripts are available in ${e} this video (${n}). Available languages: ${t.join(", ")}`)}}class l{static fetchTranscript(e,a){var l,u,d,g,p;return u=this,d=void 0,p=function*(){const u=this.retrieveVideoId(e),d=yield fetch(`https://www.youtube.com/watch?v=${u}`,{headers:Object.assign(Object.assign({},(null==a?void 0:a.lang)&&{"Accept-Language":a.lang}),{"User-Agent":t})}),g=yield d.text(),p=g.split('"captions":');if(p.length<=1){if(g.includes('class="g-recaptcha"'))throw new r;if(!g.includes('"playabilityStatus":'))throw new o(e);throw new i(e)}const h=null===(l=(()=>{try{return JSON.parse(p[1].split(',"videoDetails')[0].replace("\n",""))}catch(e){return}})())||void 0===l?void 0:l.playerCaptionsTracklistRenderer;if(!h)throw new i(e);if(!("captionTracks"in h))throw new s(e);if((null==a?void 0:a.lang)&&!h.captionTracks.some((e=>e.languageCode===(null==a?void 0:a.lang))))throw new c(null==a?void 0:a.lang,h.captionTracks.map((e=>e.languageCode)),e);const f=((null==a?void 0:a.lang)?h.captionTracks.find((e=>e.languageCode===(null==a?void 0:a.lang))):h.captionTracks[0]).baseUrl,v=yield fetch(f,{headers:Object.assign(Object.assign({},(null==a?void 0:a.lang)&&{"Accept-Language":a.lang}),{"User-Agent":t})});if(!v.ok)throw new s(e);return[...(yield v.text()).matchAll(n)].map((e=>{var t;return{text:e[3],duration:parseFloat(e[2]),offset:parseFloat(e[1]),lang:null!==(t=null==a?void 0:a.lang)&&void 0!==t?t:h.captionTracks[0].languageCode}}))},new((g=void 0)||(g=Promise))((function(e,t){function n(e){try{r(p.next(e))}catch(e){t(e)}}function a(e){try{r(p.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof g?r:new g((function(e){e(r)}))).then(n,a)}r((p=p.apply(u,d||[])).next())}))}static retrieveVideoId(t){if(11===t.length)return t;const n=t.match(e);if(n&&n.length)return n[1];throw new a("Impossible to retrieve Youtube video ID.")}}chrome.runtime.onMessage.addListener((function(e,t,n){if("get_transcript_data"===e.message){var a=new URL(window.location.href).searchParams.get("v");a&&function(e,t){void 0===t&&(t=3);var n=function(){return new Promise((function(a,r){l.fetchTranscript(e).then((function(e){e?a(e):(console.log("Transcript not found, retrying..."),t>0?setTimeout((function(){return a(n())}),1e3):r("Max retries reached. Transcript not found."))})).catch((function(e){r("Error fetching transcript:"+e)}))}))};return n()}(a).then((function(e){chrome.runtime.sendMessage({message:"transcript_data",data:e},(function(e){console.log("Transcript Data sent to Popup.HTML")}))})).catch((function(e){console.error(e)}))}}))})();